##
# Deploy WebApp pipeline template.

stages:
  # Deploy Docker image to web app.
  - stage: Deploy
    displayName: Deploy Drupal image.
    jobs:
      - job: Deploy
        displayName: Deploy
        pool:
          vmImage: 'ubuntu-latest'
        steps:

          - task: AzureRmWebAppDeployment@5
            displayName: Deploy image
            inputs:
              azureSubscription: $(resourceManagerServiceConnection)
              ResourceGroupName: $(resourceGroupName)
              appType: webAppContainer
              WebAppName: $(webAppName)
              deployToSlotOrASE: true
              SlotName: $(deploySlot)
              DockerNamespace: $(containerRegistry)
              DockerRepository: $(imageRepository)
              DockerImageTag: $(deployEnvironment)

          - task: AzureAppServiceManage@0
            displayName: Restart container
            inputs:
              azureSubscription: $(resourceManagerServiceConnection)
              ResourceGroupName: $(resourceGroupName)
              WebAppName: $(webAppName)
              SpecifySlotOrASE: true
              SlotName: $(deploySlot)
              Action: 'Restart Azure App Service'
