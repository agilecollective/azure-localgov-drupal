##
# Build and deploy to preprod slot.
#
# Builds main branch to a main tag and deploys to the main slot.

name: Build and deploy main branch to preprod slot

trigger: none

variables:

  # Build vars.
  dockerRegistryServiceConnection: '5d3bc1f7-e5cb-4616-81cc-73806dae81b6'
  containerRegistry: 'crlgd.azurecr.io'
  imageRepository: 'lgd/drupal'
  dockerfilePath: '$(Build.SourcesDirectory)/azure-web-app/Dockerfile'

  # Deploy vars.
  resourceManagerServiceConnection: 'f37bf063-ea52-4f2e-9d41-8e2b2c4e3391'
  resourceGroupName: 'rg-lgd-uksouth-001'
  webAppName: 'app-lgd-001'

  # Environment to build and deploy.
  deployEnvironment: $(Build.SourceBranchName)
  deploySlot: 'app-slot-preprod'
  environment: 'production'

stages:
  - template: templates/build.yml
  - template: templates/deploy.yml
